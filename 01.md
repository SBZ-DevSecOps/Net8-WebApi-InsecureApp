# 🔥 API Demo – Broken Object Level Authorization (BOLA) – .NET 8

**ATTENTION :** Cette API est volontairement vulnérable à API1:2023 (BOLA).  
_À usage pédagogique uniquement – ne pas utiliser en production._

## Endpoints exposés

### 📦 Orders – Commandes

| Méthode | Route                                   | Description                                      | Vulnérabilité BOLA           |
|---------|-----------------------------------------|--------------------------------------------------|------------------------------|
| GET     | `/api/bola/orders/{orderId}`            | Récupère une commande par ID                      | Aucun contrôle d’accès       |
| PUT     | `/api/bola/orders/{orderId}/status`     | Modifie le statut d’une commande                  | Modif. de commandes tierces  |
| DELETE  | `/api/bola/orders/{orderId}`            | Supprime une commande                             | Suppression arbitraire       |

### 💳 Bank Accounts – Comptes bancaires

| Méthode | Route                                           | Description                                  |
|---------|-------------------------------------------------|----------------------------------------------|
| GET     | `/api/bola/bank-accounts/{accountId}`           | Accède à n’importe quel compte               |
| PUT     | `/api/bola/bank-accounts/{accountId}/iban`      | Modifie l’IBAN d’un compte                   |
| DELETE  | `/api/bola/bank-accounts/{accountId}`           | Supprime un compte bancaire                  |
| POST    | `/api/bola/bank-accounts/{accountId}/transfer`  | Transfère des fonds depuis n’importe quel compte |

### 🩺 Medical Records – Dossiers médicaux

| Méthode | Route                                         | Description                                 |
|---------|-----------------------------------------------|---------------------------------------------|
| GET     | `/api/bola/medical-records/{recordId}`        | Accède à un dossier médical                 |
| GET     | `/api/bola/medical-records/guid/{guid}`       | Accès par identifiant GUID (pattern obscur) |
| PUT     | `/api/bola/medical-records/{recordId}/notes`  | Modifie les notes médicales                 |
| DELETE  | `/api/bola/medical-records/{recordId}`        | Supprime un dossier médical                 |
| GET     | `/api/bola/medical-records/export`            | Exporte en masse plusieurs dossiers         |

### 📄 Documents

| Méthode | Route                                               | Description                                              |
|---------|-----------------------------------------------------|----------------------------------------------------------|
| GET     | `/api/bola/documents/{documentId}/download`         | Télécharge un document                                   |
| GET     | `/api/bola/documents/by-slug/{slug}`                | Télécharge via un slug ou nom de fichier partiel         |
| POST    | `/api/bola/documents/batch-download`                | Batch download (retourne plusieurs fichiers en base64)   |
| POST    | `/api/bola/documents/{documentId}/share`            | Partage un document (génère un lien)                     |
| DELETE  | `/api/bola/documents/{documentId}`                  | Supprime un document                                     |

### 👤 Profils Utilisateurs

| Méthode | Route                                   | Description                                              |
|---------|-----------------------------------------|----------------------------------------------------------|
| GET     | `/api/bola/users/{userId}/profile`      | Accède au profil d’un autre utilisateur                  |
| GET     | `/api/bola/users/me/profile`            | Accède à son propre profil (pattern /me vulnérable)      |
| PUT     | `/api/bola/users/{userId}/role`         | Modifie le rôle d’un utilisateur (escalade de privilège) |

### ✉️ Messages

| Méthode | Route                                 | Description                           |
|---------|---------------------------------------|---------------------------------------|
| GET     | `/api/bola/messages/{messageId}`      | Lit n’importe quel message privé      |
| DELETE  | `/api/bola/messages/{messageId}`      | Supprime n’importe quel message       |

### 🔑 API Keys

| Méthode | Route                                     | Description                          |
|---------|-------------------------------------------|--------------------------------------|
| GET     | `/api/bola/api-keys/{keyId}`              | Accède à une clé API (expose la clé) |
| POST    | `/api/bola/api-keys/{keyId}/revoke`       | Révoque une clé API                  |
| DELETE  | `/api/bola/api-keys/{keyId}`              | Supprime une clé API                 |


---

## Cas d’usage malveillants typiques

- **Énumération de ressources** (`/orders/{id}`, `/bank-accounts/{id}`) par ID séquentiel, GUID ou slug.
- **Batch exploitation** : exfiltration de plusieurs ressources d’un coup (export, batch-download).
- **Modification arbitraire** de ressources critiques : statuts, soldes, rôles.
- **Suppression de ressources d’autrui**.
- **Escalade de privilèges** via `/users/{userId}/role`.
- **Exposition de données sensibles** sans aucune vérification d’appartenance.

---

## Notes pour les outils SAST/DAST/IAST

- Aucun endpoint n’implémente de vérification d’ownership ni de contrôle d’accès.
- Les routes `/by-slug`, `/guid`, `/batch-download`, `/me` sont là pour détecter les outils qui explorent au-delà du pattern “/id”.
- La surface d’attaque est maximisée pour provoquer des alertes massives sur API1:2023.

---

## Fichiers test

- **`controllers/BolaController.cs`** : toute la logique vulnérable.
- **`tests/BOLAComprehensiveIntegrationTests.cs`** : exploitation automatisée.

---

**Auteur** : _Stéphane & ChatGPT – 2025_

# 🔥 API Demo – Broken Object Level Authorization (BOLA) – .NET 8

**WARNING:** This API is intentionally vulnerable to API1:2023 (BOLA).  
_For educational use only – do not use in production._

## Exposed Endpoints

### 📦 Orders

| Method | Route                                 | Description                                 | BOLA Weakness                |
|--------|---------------------------------------|---------------------------------------------|------------------------------|
| GET    | `/api/bola/orders/{orderId}`          | Fetches any order by ID                     | No access check              |
| PUT    | `/api/bola/orders/{orderId}/status`   | Changes order status                        | Modify other users’ orders   |
| DELETE | `/api/bola/orders/{orderId}`          | Deletes any order                           | Arbitrary deletion           |

### 💳 Bank Accounts

| Method | Route                                             | Description                                 |
|--------|---------------------------------------------------|---------------------------------------------|
| GET    | `/api/bola/bank-accounts/{accountId}`             | Access any bank account by ID               |
| PUT    | `/api/bola/bank-accounts/{accountId}/iban`        | Edit IBAN on any account                    |
| DELETE | `/api/bola/bank-accounts/{accountId}`             | Delete any bank account                     |
| POST   | `/api/bola/bank-accounts/{accountId}/transfer`    | Transfer funds from any account             |

### 🩺 Medical Records

| Method | Route                                         | Description                                  |
|--------|-----------------------------------------------|----------------------------------------------|
| GET    | `/api/bola/medical-records/{recordId}`        | Access any medical record by ID              |
| GET    | `/api/bola/medical-records/guid/{guid}`       | Access by GUID (obscure identifier)          |
| PUT    | `/api/bola/medical-records/{recordId}/notes`  | Edit sensitive notes                         |
| DELETE | `/api/bola/medical-records/{recordId}`        | Delete any medical record                    |
| GET    | `/api/bola/medical-records/export`            | Bulk export of medical records               |

### 📄 Documents

| Method | Route                                               | Description                                       |
|--------|-----------------------------------------------------|---------------------------------------------------|
| GET    | `/api/bola/documents/{documentId}/download`         | Download any document by ID                       |
| GET    | `/api/bola/documents/by-slug/{slug}`                | Download by slug or partial filename              |
| POST   | `/api/bola/documents/batch-download`                | Batch download (multiple files in base64)         |
| POST   | `/api/bola/documents/{documentId}/share`            | Share a document (generates a share link)         |
| DELETE | `/api/bola/documents/{documentId}`                  | Delete any document                               |

### 👤 User Profiles

| Method | Route                                   | Description                                         |
|--------|-----------------------------------------|-----------------------------------------------------|
| GET    | `/api/bola/users/{userId}/profile`      | View any user profile                               |
| GET    | `/api/bola/users/me/profile`            | View own profile ("/me" endpoint, often overlooked) |
| PUT    | `/api/bola/users/{userId}/role`         | Change any user’s role (privilege escalation)       |

### ✉️ Messages

| Method | Route                                 | Description                        |
|--------|---------------------------------------|------------------------------------|
| GET    | `/api/bola/messages/{messageId}`      | Read any private message           |
| DELETE | `/api/bola/messages/{messageId}`      | Delete any message                 |

### 🔑 API Keys

| Method | Route                                     | Description                       |
|--------|-------------------------------------------|-----------------------------------|
| GET    | `/api/bola/api-keys/{keyId}`              | Access any API key (key exposed)  |
| POST   | `/api/bola/api-keys/{keyId}/revoke`       | Revoke any API key                |
| DELETE | `/api/bola/api-keys/{keyId}`              | Delete any API key                |


---

## Typical Attacker Use Cases

- **Resource enumeration** (`/orders/{id}`, `/bank-accounts/{id}`) via sequential IDs, GUIDs, or slugs.
- **Batch exploitation:** mass-exfiltration with endpoints like `/export` or `/batch-download`.
- **Arbitrary modification** of critical fields: status, balances, roles.
- **Deletion of other users’ resources**.
- **Privilege escalation** via `/users/{userId}/role`.
- **Sensitive data exposure** with no ownership checks.

---

## Notes for SAST/DAST/IAST Tools

- No endpoint implements any ownership or access control check.
- Endpoints like `/by-slug`, `/guid`, `/batch-download`, `/me` are included to catch tools scanning beyond classic `/id` patterns.
- The attack surface is intentionally maximized to provoke high alerting on API1:2023.

---

## Test Files

- **`controllers/BolaController.cs`** – all vulnerable logic.
- **`tests/BOLAComprehensiveIntegrationTests.cs`** – automated exploitation tests.

---

**Author:** _Stéphane & ChatGPT – 2025_

